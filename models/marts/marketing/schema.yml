version: 2

models:
  - name: fct_ad_performance
    description: Daily ad performance by channel with calculated metrics
    config:
      meta:
        kpis:
          - kpiName: 'Return on Ad Spend'
            acronym: 'ROAS'
            description: 'Revenue generated per dollar spent on advertising'
            calculation: 'conversions_value / spend'
            sourceFieldName: 'roas'
            granularity: 'Daily'
            uniqueKey: 'date_day, channel, campaign_id'
            dataType: 'ratio'
            department: 'Marketing'
            dataOwner: ''
            businessOwner: ''
            note: 'Primary paid marketing metric - wishlist section 3.1'

          - kpiName: 'Cost per Acquisition'
            acronym: 'CPA'
            description: 'Cost to acquire a customer through paid advertising'
            calculation: 'spend / conversions'
            sourceFieldName: 'cpa'
            granularity: 'Daily'
            uniqueKey: 'date_day, channel, campaign_id'
            dataType: 'currency'
            department: 'Marketing'
            dataOwner: ''
            businessOwner: ''
            note: 'Acquisition efficiency - wishlist section 3.1'

          - kpiName: 'Ad Spend'
            acronym: ''
            description: 'Total advertising spend'
            calculation: 'sum(spend)'
            sourceFieldName: 'spend'
            granularity: 'Daily'
            uniqueKey: 'date_day, channel, campaign_id'
            dataType: 'currency'
            department: 'Marketing'
            dataOwner: ''
            businessOwner: ''
            note: 'Budget tracking'

          - kpiName: 'Ad Conversions'
            acronym: ''
            description: 'Number of conversions attributed to ads'
            calculation: 'count(conversions)'
            sourceFieldName: 'conversions'
            granularity: 'Daily'
            uniqueKey: 'date_day, channel, campaign_id'
            dataType: 'count'
            department: 'Marketing'
            dataOwner: ''
            businessOwner: ''
            note: 'Conversion tracking'

          - kpiName: 'Conversion Value'
            acronym: ''
            description: 'Total revenue from ad-attributed conversions'
            calculation: 'sum(conversions_value)'
            sourceFieldName: 'conversions_value'
            granularity: 'Daily'
            uniqueKey: 'date_day, channel, campaign_id'
            dataType: 'currency'
            department: 'Marketing'
            dataOwner: ''
            businessOwner: ''
            note: 'Attribution revenue - wishlist section 3.1'

    columns:
      - name: date_day
        description: Performance date
        tests:
          - not_null

      - name: channel
        description: Ad channel
        tests:
          - not_null
          - accepted_values:
              values: ['Facebook', 'Google']

      - name: campaign_id
        description: Campaign identifier
        tests:
          - not_null

      - name: campaign_name
        description: Campaign name

      - name: spend
        description: Ad spend

      - name: conversions
        description: Number of conversions

      - name: conversions_value
        description: Value of conversions

      - name: roas
        description: Return on ad spend

      - name: cpa
        description: Cost per acquisition

  - name: fct_email_performance
    description: Email campaign and flow performance metrics
    config:
      meta:
        kpis:
          - kpiName: 'Email Open Rate'
            acronym: 'Open %'
            description: 'Percentage of recipients who opened the email'
            calculation: 'unique_opened / recipients * 100'
            sourceFieldName: 'open_rate'
            granularity: 'Email'
            uniqueKey: 'email_id'
            dataType: 'percentage'
            department: 'Marketing'
            dataOwner: ''
            businessOwner: ''
            note: 'Email engagement - wishlist section 11.5'

          - kpiName: 'Email Click Rate'
            acronym: 'Click %'
            description: 'Percentage of recipients who clicked a link in the email'
            calculation: 'unique_clicked / recipients * 100'
            sourceFieldName: 'click_rate'
            granularity: 'Email'
            uniqueKey: 'email_id'
            dataType: 'percentage'
            department: 'Marketing'
            dataOwner: ''
            businessOwner: ''
            note: 'Email engagement - wishlist section 11.5'

          - kpiName: 'Email Conversion Rate'
            acronym: 'CVR'
            description: 'Percentage of recipients who placed an order'
            calculation: 'conversions / recipients * 100'
            sourceFieldName: 'conversion_rate'
            granularity: 'Email'
            uniqueKey: 'email_id'
            dataType: 'percentage'
            department: 'Marketing'
            dataOwner: ''
            businessOwner: ''
            note: 'Email effectiveness'

          - kpiName: 'Email Revenue'
            acronym: ''
            description: 'Total revenue attributed to email'
            calculation: 'sum(attributed_revenue)'
            sourceFieldName: 'revenue'
            granularity: 'Email'
            uniqueKey: 'email_id'
            dataType: 'currency'
            department: 'Marketing'
            dataOwner: ''
            businessOwner: ''
            note: 'Email performance - wishlist section 11.5'

          - kpiName: 'Email Net Revenue'
            acronym: ''
            description: 'Revenue minus refunds and cancellations'
            calculation: 'revenue - refunds - cancellations'
            sourceFieldName: 'net_revenue'
            granularity: 'Email'
            uniqueKey: 'email_id'
            dataType: 'currency'
            department: 'Marketing'
            dataOwner: ''
            businessOwner: ''
            note: 'Net email impact'

          - kpiName: 'Revenue per Recipient'
            acronym: 'RPR'
            description: 'Average revenue generated per email recipient'
            calculation: 'revenue / recipients'
            sourceFieldName: 'calculated'
            granularity: 'Email'
            uniqueKey: 'email_id'
            dataType: 'currency'
            department: 'Marketing'
            dataOwner: ''
            businessOwner: ''
            note: 'Email efficiency - wishlist section 11.5'

    columns:
      - name: email_id
        description: Unique email identifier (campaign_id or flow_id)
        tests:
          - unique
          - not_null

      - name: email_type
        description: Email type
        tests:
          - not_null
          - accepted_values:
              values: ['Campaign', 'Flow']

      - name: email_name
        description: Email name

      - name: email_category
        description: Classified email category
        tests:
          - not_null

      - name: recipients
        description: Number of recipients

      - name: open_rate
        description: Open rate percentage

      - name: click_rate
        description: Click rate percentage

      - name: conversion_rate
        description: Conversion rate percentage

      - name: revenue
        description: Attributed revenue

      - name: net_revenue
        description: Revenue minus refunds and cancellations

      - name: channel
        description: Channel identifier
        tests:
          - not_null
          - accepted_values:
              values: ['Email']

  - name: fct_ga4_funnel
    description: Daily website funnel metrics with conversion and dropoff rates
    config:
      meta:
        kpis:
          - kpiName: 'Overall Conversion Rate'
            acronym: 'CVR'
            description: 'Percentage of sessions that resulted in purchase'
            calculation: 'converted_sessions / total_sessions * 100'
            sourceFieldName: 'overall_conversion_rate'
            granularity: 'Daily'
            uniqueKey: 'session_date, deepest_funnel_stage'
            dataType: 'percentage'
            department: 'Marketing'
            dataOwner: ''
            businessOwner: ''
            note: 'Website performance - wishlist section 10.1'

          - kpiName: 'Homepage to PLP Rate'
            acronym: ''
            description: 'Percentage of homepage visitors who reach product list page'
            calculation: 'plp_sessions / homepage_sessions * 100'
            sourceFieldName: 'homepage_to_plp_rate'
            granularity: 'Daily'
            uniqueKey: 'session_date, deepest_funnel_stage'
            dataType: 'percentage'
            department: 'Marketing'
            dataOwner: ''
            businessOwner: ''
            note: 'Funnel stage conversion - wishlist section 10.1'

          - kpiName: 'PLP to PDP Rate'
            acronym: ''
            description: 'Percentage of PLP visitors who reach product detail page'
            calculation: 'pdp_sessions / plp_sessions * 100'
            sourceFieldName: 'plp_to_pdp_rate'
            granularity: 'Daily'
            uniqueKey: 'session_date, deepest_funnel_stage'
            dataType: 'percentage'
            department: 'Marketing'
            dataOwner: ''
            businessOwner: ''
            note: 'Product engagement - wishlist section 11.1'

          - kpiName: 'PDP to Cart Rate'
            acronym: 'Add to Cart %'
            description: 'Percentage of PDP visitors who add items to cart'
            calculation: 'cart_sessions / pdp_sessions * 100'
            sourceFieldName: 'pdp_to_cart_rate'
            granularity: 'Daily'
            uniqueKey: 'session_date, deepest_funnel_stage'
            dataType: 'percentage'
            department: 'Marketing'
            dataOwner: ''
            businessOwner: ''
            note: 'Purchase intent - wishlist section 11.1'

          - kpiName: 'Cart to Checkout Rate'
            acronym: ''
            description: 'Percentage of cart sessions that begin checkout'
            calculation: 'checkout_sessions / cart_sessions * 100'
            sourceFieldName: 'cart_to_checkout_rate'
            granularity: 'Daily'
            uniqueKey: 'session_date, deepest_funnel_stage'
            dataType: 'percentage'
            department: 'Marketing'
            dataOwner: ''
            businessOwner: ''
            note: 'Checkout initiation - wishlist section 10.1'

          - kpiName: 'Checkout to Purchase Rate'
            acronym: ''
            description: 'Percentage of checkout sessions that complete purchase'
            calculation: 'purchase_sessions / checkout_sessions * 100'
            sourceFieldName: 'checkout_to_purchase_rate'
            granularity: 'Daily'
            uniqueKey: 'session_date, deepest_funnel_stage'
            dataType: 'percentage'
            department: 'Marketing'
            dataOwner: ''
            businessOwner: ''
            note: 'Checkout completion - wishlist section 10.1'

          - kpiName: 'Average Order Value'
            acronym: 'AOV'
            description: 'Average order value from converted sessions'
            calculation: 'total_revenue / converted_sessions'
            sourceFieldName: 'avg_order_value'
            granularity: 'Daily'
            uniqueKey: 'session_date, deepest_funnel_stage'
            dataType: 'currency'
            department: 'Executive'
            dataOwner: ''
            businessOwner: ''
            note: 'Order value metric'

    columns:
      - name: session_date
        description: Date of sessions
        tests:
          - not_null

      - name: deepest_funnel_stage
        description: Deepest stage reached in funnel
        tests:
          - not_null
          - accepted_values:
              values: ['Homepage', 'Product List', 'Product Detail', 'Add to Cart', 'Begin Checkout', 'Purchase', 'Other']

      - name: total_sessions
        description: Total sessions reaching this stage

      - name: unique_users
        description: Unique users in sessions

      - name: converted_sessions
        description: Sessions that resulted in purchase

      - name: overall_conversion_rate
        description: Overall conversion rate (%)

      - name: homepage_to_plp_rate
        description: Conversion rate from homepage to PLP (%)

      - name: plp_to_pdp_rate
        description: Conversion rate from PLP to PDP (%)

      - name: pdp_to_cart_rate
        description: Conversion rate from PDP to cart (%)

      - name: cart_to_checkout_rate
        description: Conversion rate from cart to checkout (%)

      - name: checkout_to_purchase_rate
        description: Conversion rate from checkout to purchase (%)

      - name: total_revenue
        description: Total revenue from converted sessions

      - name: avg_order_value
        description: Average order value for converted sessions
